---
description: 在浏览器里输入一个网址到网页显示出来的完整过程
---

# 访问网站全过程

当我们在浏览器里输入一个有效网址，按下回车键后，到页面完全呈现出来的过程可以分成以下几步：

![访问网站流程](<../.gitbook/assets/image (7) (1) (1).png>)

## DNS 解析

当用户输入一个网址并按下回车键的时候，浏览器获得一个域名，而在实际通信过程中，我们需要的是一个 IP 地址，因此我们需要先把域名转换成相应 IP 地址，通过 DNS 解析获取相应 IP 地址。详细的 DNS 解析参见[这里](../ji-suan-ji-wang-luo/dns.md)。

> #### **前端如何做 DNS 优化？**
>
> * 前端的dns优化，可以在html页面头部写入dns缓存地址，比如
>
> ```html
> <meta http-equiv="x-dns-prefetch-control" content="on" />
> <link rel="dns-prefetch" href="http://bdimg.share.baidu.com" />
> ```

## TCP 连接

浏览器通过 DNS 获取到 Web 服务器真正的 IP 地址后，便向 Web 服务器发起 TCP 连接请求，通过三次握手进行连接。详细的 TCP 连接过程参见[这里](../ji-suan-ji-wang-luo/chuan-shu-ceng.md)。

大致的三次握手流程如下：

* 第一次握手：主机 A 发送位码为 SYN＝1 的 TCP 包给服务器，并且随机产生一个作为确认号（这是 TCP 包的一部分），主机 B 收到 SYN 码后知道 A 要求建立连接;
* 第二次握手：主机 B 收到请求后，向A发送确认号（主机 A 的 seq+1），syn=1，seq=随机数 的TCP包；
* 主机 A 收到后检查确认号是否正确，即第一次 A 发送的确认号是否+1了，以及位码 ack 是否为1，若正确，主机 A 会再发送确认号(主机 B 的 seq+1)，ack=1，主机 B 收到后确认 seq 值与 ack=1 则连接建立成功。

> #### **为什么两次握手不行？**
>
> * 因为第二次握手，主机 B 还不能确认主机 A 已经收到确认请求，也是说 B 认为建立好连接，开始发数据了，结果发出去的包一直 A 都没收到，那攻击 B 就很容易了，我专门发包不接收，服务器很容易就挂了。

> #### 从网卡把数据包传输出去到服务器收到的过程？
>
> * 先从局域网把数据发送到公司的交换机（如果交换机没有缓存本地 mac 地址和 IP 地址的映射，此时会通过 ARP 协议来获得），交换机的好处是可以隔离冲突域（因为以太网用的是 CSMA/CD 协议，这个协议规定网线上同一时刻只能有一台机器发送数据），这样就可以不仅仅同一时刻只有一台机器发送网络包了；
> * 然后交换机再将数据发送到路由器，路由器相当于公司网关，路由器具有转发和分组数据包的功能（路由器通过选定的路由协议会构造出路由表，同时不定期的跟相邻路由器交换路由信息），然后这算是经过了物理层，数据链路层（以太网），开始到网络层进行数据转发了；
> * 然后路由器转发IP数据报，一般公司的 IP 地址都会经过 NAT 转换，让内网的 ip 也能够访问外网。通过路由器的分组传输，所有数据到达服务器；
> * 然后服务器的传输层协议开始发挥作用，根据 TCP 包里的端口号，让服务器特定的服务来处理到来的数据包，并且 TCP 是面向字节流的(TCP 有四大特性，可靠传输、流量控制、拥塞控制、连接管理)；
> * 最后数据由传输层转交给应用层，也就是 http 服务（或者https），后端经过一系列逻辑处理，返回给前端数据。

## 发送 HTTP 请求

浏览器向 Web 服务器发起一个 HTTP 请求，HTTP 协议是建立在 TCP 协议之上的应用层协议，其本质是在建立起的 TCP 连接中，按照 HTTP 协议标准发送一个索要网页的请求。

## 服务器处理 HTTP 请求

服务器获取到客户端的 HTTP 请求后，会根据 HTTP 请求中的内容来决定如何获取相应的文件，并将文件发送给浏览器。

## 浏览器渲染网页

浏览器根据响应开始显示页面，首先解析 HTML 文件构建 DOM 树，然后解析 CSS 文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。

## 断开 TCP 连接

客户端和服务器通过四次挥手终止 TCP 连接。详细内容参见[这里](../ji-suan-ji-wang-luo/chuan-shu-ceng.md)。

## 参考

* [https://juejin.cn/post/6928677404332425223](https://juejin.cn/post/6928677404332425223)
* [https://www.cnblogs.com/lepeCoder/p/15147895.html](https://www.cnblogs.com/lepeCoder/p/15147895.html)
