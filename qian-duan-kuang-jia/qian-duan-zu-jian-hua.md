# 前端组件化

## 一、引言

前端架构中有两个最热门的话题，一个就是组件化，另一个就是架构模式。组件化的概念是从开始研究如何扩展 HTML 标签开始的，最后延伸出来的一套前端架构体系。而它最重要的作用就是提高前端代码的复用性。

所以说，前端架构当中，组件化可以说是重中之重。在实际工程当中，其实组件化往往会比架构模式要更重要一些。因为组件化直接决定了一个前端团队代码的复用率，而一个好的组件化体系是可以帮助一个前端团队提升他们代码的复用率，从而也提升了团队的整体效率。

## **二、组件的基本概念**

我们可以认为组件就是页面里的 UI 组件，一个页面可以由很多组件构成。例如一个后台管理系统页面，可能包含了 `Header`、`Sidebar`、`Main` 等各种组件。

一个组件又包含了 `template(html)`、`script`、`style` 三部分，其中 `script`、`style` 可以由一个或多个模块组成。

![组件化](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85b61d1df959425ba68a96d5d1cdd98e\~tplv-k3u1fbpfcp-zoom-1.image)

从上图可以看到，一个页面可以分解成一个个组件，每个组件又可以分解成一个个模块，充分体现了分治的思想。

由此可见，页面成为了一个容器，组件是这个容器的基本元素。组件与组件之间可以自由切换、多次复用，修改页面只需修改对应的组件即可，大大的提升了开发效率。

最理想的情况就是一个页面元素全部由组件构成，这样前端只需要写一些交互逻辑代码。虽然这种情况很难完全实现，但我们要尽量往这个方向上去做，争取实现全面组件化。

组件是与 UI 强相关的，所以某种意义上我们可以认为组件是特殊的模块或者是特殊的对象。

> **组件既是对象也是模块**

组件化的特点是可以使用树形结构来进行组合，并且有一定的模版化的配置能力。对于复杂的前端应用，我们只需要拆成一块一块的组件，完成每一个组件的编写，再拼装成组件树。

![组件化](https://ahabhgk.github.io/static/b5c08269dfc26ae6d7db3801e9efd296/7d769/components.png)

## **三、对象与组件的区别**

#### **对象**

首先我们来看**对象**，它有三大要素：

* 属性 —— Properties
* 方法 —— Methods
* 继承关系 —— Inherit

在 JavaScript 中的普通对象可以用它的属性，方法和继承关系来描述。而这里面的继承，在 JavaScript 中是使用原型继承的。

这里说的 “普通对象” 不包含复杂的函数对象或者是其他的特殊对象，而在 JavaScript 当中，属性和方法是一体的。

#### 组件

相对比对象，组件里面包含的语义要素会更丰富一点，**组件**中的要素有：

* 属性 —— Properties
* 方法 —— Methods
* 继承 —— Inherit
* 特性 —— Attribute
* 配置与状态 —— Config & State
* 事件 —— Event
* 生命周期 —— Lifecycle
* 子组件 —— Children

Properties 和 Attribute 在英语的含义中是有很大的区别的，但是往往都会翻译成 “属性”。如果遇到两个单词都出现的时候，就会把 Attribute 翻译为 “特性”，把 Properties 翻译成 “属性”。

接下来就是组件的 Config，它就是对组件的一种配置。我们经常会在一个构造函数创建一个对象的时候用到 Config ，我们传入这个构造函数的参数就叫 “ Config”(配置)。

同时组件也会有 state(状态)。当用户去操作或者是一些方法被调用的时候，一个 state 就会发生变化。这种就是组件的状态，是会随着一些行为而改变的。而 state 和 properties、attributes、config 都有可能是相识或者相同的。

event 就是 “事件” 的意识，而一个事件是组件往外传递的。我们的组件主要是用来描述 UI 这样的东西，基本上它都会有这种事件来实现它的某种类型的交互。

每一个组件都会有生命周期 lifecycle，这个一会儿在文章的后面会详细的展开学习。

组件的 children 是非常重要的一部分，children 也是组件当中一个必要的条件，因为没有 children 组件就不可能形成树形结构，那么描述界面的能力就会差很多。

之前有一些比较流行的拖拽系统，我们可以把一些写好的 UI 组件拖到页面上，从而建立我们的系统界面。但是后面发现除了可以拖拽在某些区域之外，还需要一些自动排序，组件嵌套组件的功能需求。这个时候组件与组件之间没有树形结构就不好使了。

最后组件在对象的基础上添加了很多语义相关的概念，也是这样使得组件变成了一种非常适合描述 UI 的概念。

## **四、组件构成**

我们用一张图来更深入的了解组件。

![组件](https://mmbiz.qpic.cn/mmbiz\_png/3kV9723M8ibTUKuRPQcgAd7RUDvPXMwaGib78ibIftjRHq4XvFG7RwBKKSfK8CPR1JhQIUqYJpteGksto3jm7aT2A/640?wx\_fmt=png\&wxfrom=5\&wx\_lazy=1\&wx\_co=1)

组件最直接产生变化的来源就是用户的输入和操作，比如说当一个用户在我们的选择框组件中选中了一个选项时，这个时候我们的状态 state，甚至是我们的子组件 children 都会发生变化。

图中右边的这几种情况就是组件的开发者与组件的关系。其中一种就是开发者使用了组件的标记代码 Markup Code，来对组件产生影响。其实，也就是开发者通过组件特性 Attribute 来更改组件的一些特征或者是特性。

Attribute 是一种声明型的语言，也是标记型代码 Markup Code。而 Markup Code 也不一定是我们的 HTML 这种 XML 类的语言。在标记语言的大生态中，其实有非常多的语言可以用来描述一个界面的结构。但是最主流的就是基于 XML 体系的。在我们 Web 领域里面最常见的就是 XML 。而 JSX 也可以理解为一种嵌入在编程语言里面的 XML 结构。

开发者除了可以用 Attribute，也可以用 Property 来影响组件。这个组件本身是有 Property (属性)的，当开发者去修改一个组件的属性时，这个组件就会发生变化。而这个就是与对象中的 属性 Property 是一样的概念。

> Attribute 和 Property 是不是一样的呢？有的时候是，有的时候也不是，这个完全取决于组件体系的设计者。组件的实现者或者是设计者可以让 attribute 和 property 统一。甚至我们把 state、config、attribute、property 四者都全部统一也是可以的。

然后就是方法 method，它是用于描述一个复杂的过程，但是在 JavaScript 当中的 Property 是允许有 get 和 set 这样的方法的，所以最终 method 和 property 两者的作用也是差不多的。

那么这里我们可以确定一个概念，使用组件的开发者会使用到 method 和 property，这些组件的要素。但是如果一个开发组件的开发者需要传递一个消息给到使用组件的程序员，这个时候就需要用到 事件 event。当一个组件内部因为某种行为或者事件触发到了变化时，组件就会给使用者发送 event 消息。所以这里的 event 的方向就是反过来的，从组件往外传输的。

通过这张图我们就可以清楚知道组件的各个要素的作用，以及他们的信息流转方向。

## **五、组件状态**

这里我们来分析一下，property、attribute、state、config 在组件设计中都有什么区别。

这里 Winer 老师给我们整理了一个表格，分成了四个场景：

* Markup set —— 用标签去设置
* JavaScript Set —— 使用 JavaScript 代码去设置
* JavaScript Change —— 使用 JavaScript 代码去改变
* User Input Change —— 终端用户的输入而改变

| Markup set | JavaScript set | JavaSscript Change | User Input Change |           |
| ---------- | -------------- | ------------------ | ----------------- | --------- |
| ❌          | ✅              | ✅                  | ❓                 | property  |
| ✅          | ✅              | ✅                  | ❓                 | attribute |
| ❌          | ❌              | ❌                  | ✅                 | state     |
| ❌          | ✅              | ❌                  | ❌                 | config    |

那么我们一个一个来讲述一下：

**Property**

* 它是不能够被 markup 这种静态的声明语言去设置的
* 但是它是可以被 JavaScript 设置和改变的
* 大部分情况下 property 是不应该由用户的输入去改变的，但是小数情况下，可能是来源于我们的业务逻辑，才有可能会接受用户输入的改变

**Attribute**

* 用户的输入就不一定会改变它，与 Property 同理
* 是可以由 markup，JavaScript 去设置的，同时也是可以被 JavaScript 所改变的

**State**

* 状态是会由组件内部去改变的，它不会从组件的外部进行改变。如果我们想设计一个组件是从外部去改变组件的状态的话，那么我们组件内部的 state 就失控了。因为我们不知道组件外部什么时候会改变我们组件的 state，导致我们 state 的一致性无法保证。
* 但是作为一个组件的设计者和实践者，我们一定要保证用户输入是能改变我们组件的 state 的。比如说用户点击了一个 tab，然后点中的 tab 就会被激活，这种交互一般都会用 state 去控制的。

**Config**

* Config 在组件中是一个一次性生效的东西，它只会在我们组件构造的时候触发。所以它是不可更改的。也是因为它的不可更改性，所以我们通常会把 config 留给全局。通常每个页面都会有一份 config，然后拿着这个在页面内去使用。

## 六、组件类型

组件根据其类型大体可以分为这四种：

* 展示型组件：无状态的，stateless，props 进 UI 出
* 交互型组件：有自身的状态，stateful，props 进 UI 出，讲究复用，UI 库中常见
* 接入型组件：连接 service 与 UI，会调用 api 获取数据，管理数据等
* 功能型组件：会有一些功能的实现，不渲染任何东西，比如 `<router-view />`

## **七、组件生命周期**

讲到生命周期，我们最容易想到的会有两个，一个是 created 一个是 destroy。世界万物的生命必定会有 出生 和 死亡，这两个生命周期。

那么在这两个开始与结束之间有什么生命周期呢?我们就需要想一下，一个组件在构造到销毁之间都会发生什么事情。

一个组件有一个非常重要的事情，就是它被创建之后，它有没有被显示出来。这里就涉及生命周期中的 mount，也就是组件有没有被挂載到 “屏幕的这棵树上”。这个生命周期我们可以在 React 和 Vue 里面看到，我们经常会使用这个生命周期，在组件被挂載后做一些相应的初始化操作。

有挂載那必然就会有卸载，所以组件中的 mount 和 unmount 是一组生命周期。而这个挂載与卸载的整个生命周期是可以反复的发生的，我们可以挂上去然后卸下来，然后再挂上去，这样反复又反复的走这个生命周期。

所以在 unmount 之后，我们是可以回到 created 构建组件的这个生命周期的状态。

那么组件还会在什么时候发生状态更变呢?这里我们就有两种情况：

* 程序员使用代码去改变或者设置这个组件的状态
* 用户输入时影响了组件的状态

比如说我们用户点了一下按钮或者 Tab，这个时候就会触发这个组件的状态更变。同时也会产生一个组件的生命周期，而这个生命周期就是 Render 渲染或者 Update 更新。

所有这些生命周期加在一起就是我们一个组件完整的生命周期。我们看到的所谓 willMount、didMount 无非就是这个生命周期之中更细节的位置。下面我给大家附上一张完整的生命周期的图。

![组件生命周期](https://mmbiz.qpic.cn/mmbiz\_png/3kV9723M8ibTUKuRPQcgAd7RUDvPXMwaGmkQwTU1NT8pyVDfggKHSKsWzMI7icez6mib17XKQR1tr83s6CMkib7cHA/640?wx\_fmt=png\&wxfrom=5\&wx\_lazy=1\&wx\_co=1)

## 八、参考

* [聊一聊前端组件化](https://developer.51cto.com/article/638362.html)
* [聊聊组件设计](https://zhuanlan.zhihu.com/p/78472109)
* [前端组件化](https://chinese.freecodecamp.org/news/front-end-engineering-components/)
* [前端组件化框架之路](https://www.wenjiangs.com/article/wiyj81og5c.html)
