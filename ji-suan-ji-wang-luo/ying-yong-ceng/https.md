# HTTPS

## HTTPS 内容

HTTPS 还是通过了 HTTP 来传输信息，但是信息通过 TLS 协议进行了加密。

TLS 协议位于传输层之上，应用层之下。首次进行 TLS 协议传输需要两个 RTT ，接下来可以通过 Session Resumption 减少到一个 RTT。

在 TLS 中使用了两种加密技术，分别为：对称加密和非对称加密。

HTTPS的详细内容可以参见这篇[文章](https://juejin.cn/post/6844904079974465544)。总结如下：

### 为什么需要加密

因为 HTTP 的内容是明文传输的，如果信息在传输过程中被劫持，传输的内容就完全暴露了。劫持者不仅可以读取内容，还可以篡改传输的信息且不被双方察觉，这就是`中间人攻击`。所以我们才需要对信息进行加密来保障传输的可靠性。

### 对称加密

对称加密就是只有一个私钥，它可以对一段内容加密，加密后只能用它才能解密看到原本的内容，和我们日常生活中用的钥匙作用差不多。

HTTPS 如果使用对称加密的弊端在于私钥还是需要通过网络从服务器传递给客户端，攻击者同样可以从中劫持来获取私钥信息，这样就算以后的内容进行过加密，但是对已经有私钥的攻击者来说已经是明文的了，同样可以读取和篡改传输内容。

### 非对称加密

非对称加密则是有两把密钥，通常一把叫做公钥、一把叫做私钥，用公钥加密的内容必须用私钥才能解开，同样，用私钥加密的内容只有公钥才能解开。注意用公钥加密的内容用公钥是解不开的，私钥亦是如此。私钥通常存放于服务器端，仅有拥有者可见，而公钥需要传递给客户端。

非对称加密虽然相比对称加密有了很大的安全性提升，但是如果 HTTPS 仅使用非对称加密的话，还是存在被攻击的风险：

* 攻击者在服务器把公钥传输给客户端的过程中进行窃取从而获得公钥，而公钥是可以解开私钥加密的内容的，所以从服务器端经过私钥加密的内容对于拥有公钥的攻击者来说同样的透明的。而从客户端经过公钥加密的内容此时对于攻击者来说是解不开的。
* 更进一步，在服务器把公钥传输给客户端的过程中，攻击者不仅可以窃取公钥，还可以篡改公钥，用自己的公钥替换之，并且自己还有与之对应的私钥。此时攻击者就相当于一个完全的代理，所有内容都经他中转，进而可以随意地获取和篡改。

### 非对称加密+非对称加密

如果在客户端和服务器端都使用非对称加密，这样看上去要安全很多，但是攻击者同样可以作为一个中间代理来进行获取和篡改。而且最主要的原因是非对称加密算法非常耗时，特别是加密解密一些较大数据的时候有些力不从心，而对称加密快很多，所以这种方法实际操作起来不太可行。

### 对称加密+非对称加密

对称加密+非对车 过程：

1. 某网站拥有用于非对称加密的公钥A、私钥A’。
2. 浏览器像网站服务器发送请求，服务器把公钥A明文给传输浏览器。
3. 浏览器随机生成一个用于对称加密的密钥X，用公钥A加密后传给服务器。
4. 服务器拿到后用私钥A’解密得到密钥X。
5. 这样双方就都拥有密钥X了，且别人无法知道它。之后双方所有数据都用密钥X加密解密。

完美！HTTPS基本就是采用了这种方案。完美？还是有漏洞的。
