# 数据链路层

## 一、数据链路层功能

数据链路层在物理层提供的服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层。数据链路层在不可靠的物理介质上提供可靠的传输。

### 1. 封装成帧

将网络层传下来的分组前后分别添加首部和尾部，这样就构成了帧。首部和尾部的一个重要作用是帧定界，也携带了一些必要的控制信息，对于每种数据链路层协议都规定了帧的数据部分的最大长度。&#x20;

### 2. 透明传输

帧使用首部和尾部进行定界，如果帧的数据部分含有和首部和尾部相同的内容， 那么帧的开始和结束的位置就会判断错，因此需要在数据部分中出现有歧义的内容前边插入转义字符，如果数据部分出现转义字符，则在该转义字符前再加一个转义字符。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。&#x20;

### 3. 差错检测

目前数据链路层广泛使用循环冗余检验（CRC）来检查数据传输过程中是否产生比特差错。

## 二、数据链路层设备

### 1. 网桥

根据 MAC 帧的目的地址进行转发和过滤。当网桥收到一个帧时，并不会向所有接口转发此帧，而是先检查此帧的目的 MAC`地址`，然后再确定将该帧转发到哪一个口，或者是把它丢弃。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1d1ce4ecdee47689b52709bc49d57af\~tplv-k3u1fbpfcp-watermark.awebp)

> 网桥连接的是不同的网段，同一网段指的是`IP地址`和`子网掩码`相与得到相同的网络地址。

### 2. 以太网交换机

谈到交换机，就不得不提两个概念，冲突域和广播域

* 冲突域： 是指同一时间只能由一台设备发送信息的范围。
* 广播域：如果站点发出一个广播信号，所有能接收到这个信号的设备范围称为广播域
* 也就是说，广播域可以跨网段，而冲突域只是发生的同一个网段。

## 三、以太网协议

以太网协议是一种使用广泛的局域网技术，是一种应用于数据链路层的协议，使用以太网可以完成相邻设备的数据帧传输。

### 1. 以太网帧格式

![以太网帧](<../.gitbook/assets/image (12) (1).png>)

* 其中目的地址和源地址指的是 MAC 地址，即设备的物理地址。MAC地址用于标示网卡，每个网卡都具有唯一的 MAC 地址；
* 当在同一个局域网中，主机A需要给主机B发送消息时，主机A将以太网帧发出，此时局域网中所有主机均可收到这个帧，主机中的网卡接收到以太网帧后，会将目的 MAC 地址和自己的 MAC 地址进行比较,如果不相同就会丢弃，如果相同则会接收，此时则Ｂ主机就收到了Ａ 的消息；
* 其最后面是 CRC 循环冗余码，用于差错控制，即检验帧的正确性；
* 在以太网协议中，目的地址分为三种单播地址、广播地址、多播地址，其中单播地址如上面Ａ给Ｂ主机发送，其接收者为一个，并且其目的地址的最高字节的低位为０。

### 2. 以太网特点

* 无连接。发送方和接收方不建立连接。
* 不可靠。接收方不向发送方进行确认，差错帧直接丢弃。

### 3. 以太网拓扑结构

跟以太网相关的拓扑结构有星型和总线型。

![星型拓扑结构](<../.gitbook/assets/image (8) (1) (1).png>)



![总线型拓扑结构](<../.gitbook/assets/image (13) (1).png>)

互联网初期，以太网的总线型拓扑比较普遍。随着总线型以太网上的站点数目增多，可靠性也会随之下降，而随着大规模集成电路以及专门芯片的发展,使得星型以太网变得便宜又可靠。

> 需要注意的是，以太网虽然物理上是星型拓扑，但逻辑上是总线型。

## 四、PPP 协议

互联网用户通常需要连接到某个 ISP 之后才能接入到互联网，PPP（点对点）协议是用户计算机和 ISP 进行通信时所使用的数据链路层协议。点对点协议为点对点连接上传输多协议数据包提供了一个标准方法。该协议设计的目的主要是用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种主机、网桥和路由器之间简单连接的一种解决方案。

### 1. PPP 协议特点

PPP 协议具有以下特点：

* PPP 协议具有动态分配 IP 地址的能力，其允许在连接时刻协商 IP 地址。
* PPP 支持多种网络协议，例如 TCP/IP、NETBEUI 等。
* PPP 具有差错检测能力，但不具备纠错能力，所以 PPP 是不可靠传输协议。
* 无重传的机制，网络开销小，速度快。
* PPP 具有身份验证的功能

## 五、MAC 地址和 IP 地址

### **1. MAC** 地址

数据链路层和物理层使用的地址，是写在**网卡上的物理地址**。MAC 地址用来**定义网络设备的位置**。

* MAC地址长度为6字节，48位；
* MAC地址具有唯一性，每个网络适配器对应一个MAC地址；
* 通常采用十六进制表示法，每个字节表示一个十六进制数，用 - 或 : 连接起来；
* MAC广播地址：FF-FF-FF-FF-FF-FF。

### **2. IP** 地址

网络层和以上各层使用的地址，是一种**逻辑地址**。IP 地址用来**区别网络上的计算机**。

### 3. 可以只有 IP 地址吗

只有当设备连入网络时，才能根据他进入了哪个子网来为其分配 IP 地址，在设备还没有 IP 地址的时候或者在分配 IP 地址的过程中，我们需要 MAC 地址来区分不同的设备。

### 4. 可以只有 MAC 地址吗

如果我们只使用 MAC 地址进行寻址的话，我们需要路由器记住每个 MAC 地址属于哪一个子网，不然每一次路由器收到数据包时都要满世界寻找目的 MAC 地址。而我们知道 MAC 地址的长度为 48 位，也就是说最多总共有 2 的 48 次方个 MAC 地址，这就意味着每个路由器需要 256 T 的内存，这显然是不现实的。

和 MAC 地址不同，IP 地址是和地域相关的，在一个子网中的设备，我们给其分配的 IP 地址前缀都是一样的，这样路由器就能根据 IP 地址的前缀知道这个设备属于哪个子网，剩下的寻址就交给子网内部实现，从而大大减少了路由器所需要的内存。

光有 MAC 地址的话，寻址困难。IP 地址和地域有关，可以分区域寻址，效率更高。
